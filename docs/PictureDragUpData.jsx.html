<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: PictureDragUpData.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: PictureDragUpData.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, {Component} from 'react'
import axios from '../../Public/js/axios'

class PictureDragUpData extends Component {
    constructor(props) {
        super(props)
        this.state = {
            isDrag: false,
            imageUpdata: null, // 上传图片数组
            imgList: [],
            serverList: []
        }
    }

    async componentDidMount() {
        let data = await axios.ajax('pic/allPicture')
        this.setState({
            serverList: data.data
        })
    }

    componentWillUpdate() {
    }

    /**
     * Method Start
     * **/
    dragEnter(e) {
        // 拖入
        e.preventDefault()
        this.setState({
            isDrag: true
        })
    }

    dragOver(e) {
        // 拖动
        e.preventDefault()
    }

    dragLeave(e) {
        // 拖出
        e.preventDefault()
        this.setState({
            isDrag: false
        })
    }

    drop(e) {
        // 放下
        e.preventDefault()
        let _p = e.dataTransfer.files
        this.disposePicture(_p)
        this.setState({
            isDrag: false,
            imageUpdata: e.dataTransfer.files
        })
    }

    disposePicture(_p) {
        const self = this
        if (_p.length === 0) return
        // let img = window.webkitURL.createObjectURL(_p[0])
        // 声明图片信息
        Array.prototype.map.call(_p, (e) => {
            let reader = new window.FileReader()
            reader.readAsDataURL(e)
            reader.onload = function (oireader) {
                // 解构设置state
                self.setState(state => ({
                        imgList: [...state.imgList, oireader.target.result]
                    })
                )
            }
            return true
        })
    }

     uploadImage() {
        Array.prototype.map.call(this.state.imageUpdata, async (e) => {
            let formData = new FormData()
            formData.append('file', e)
            await axios.fileUpata(formData, 'pic/picture/upload')
        })
    }


    /**
     * Method End
     * **/

    render() {
        const isDrag = this.state.isDrag
        let hint = isDrag ? `Drag` : `Drag-upDataPicture`

        /**
         * 拖拽在线预览图片
         * */
        const imgList = this.state.imgList
        let imgUrl = null
        if (imgList.length >= 0) {
            imgUrl = imgList.map((e, index) => {
                return &lt;li className="image__items" key={index}>
                    &lt;img alt="" src={e}/>
                &lt;/li>
            })
        }

        /**
         * 数据库数据读取
         * */
        // let sergerImag = this.state.serverList.map((e, index) => {
        //     let _src = 'http://127.0.0.1' + e.Picture
        //     console.log(_src)
        //     return &lt;li className="image__items" key={index}>
        //         &lt;img src={_src} alt=""/>
        //     &lt;/li>
        // })
        //


        return (
            &lt;div>
                &lt;div id="drag-area"
                     onDragEnter={(e) => this.dragEnter(e)}
                     onDragOver={(e) => this.dragOver(e)}
                     onDragLeave={(e) => this.dragLeave(e)}
                     onDrop={(e) => this.drop(e)}>
                    {hint}
                &lt;/div>
                &lt;ul className="image__list">
                    {imgUrl}
                &lt;/ul>

                {/*&lt;ul className="image__list--server">*/}
                    {/*{sergerImag}*/}
                {/*&lt;/ul>*/}

                &lt;button onClick={(e) => this.uploadImage(e)}>
                    upload Image
                &lt;/button>
            &lt;/div>
        )
    }
}

export default PictureDragUpData</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Sat Nov 18 2017 16:45:56 GMT+0800 (CST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
